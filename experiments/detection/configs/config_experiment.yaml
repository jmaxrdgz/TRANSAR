# config_experiment.yaml
# Configuration for YOLO detection experiments with multiple backbones

SEED: 42

MODEL:
  NAME: YOLO
  IN_SIZE: 256
  IN_CHANS: 1  # SAR images are single-channel

  BACKBONE:
    NAME: swinv2_tiny_window8_256  # Options: swinv2_tiny_window8_256, resnet50, convnext_tiny, etc.
    PRETRAINED: true  # Use ImageNet pretrained weights
    WEIGHTS: null  # Path to custom pretrained weights (overrides PRETRAINED if set)

  # Progressive unfreezing
  NUM_BLOCKS_TO_UNFREEZE: 0  # 0 = freeze entire backbone, 1-4 = unfreeze last N blocks

  # YOLO detection parameters (single-scale)
  STRIDES: [32]  # Feature stride for last backbone feature (P5)

  # Anchor boxes for single scale (in pixel space)
  # Format: [scale_anchors] - single scale with 3 anchors
  # Each anchor: (w, h) in pixels
  ANCHORS:
    - [[116, 90], [156, 198], [373, 326]]  # P5/32 - larger anchors for deeper features

  # Loss weights
  LOSS_WEIGHTS:
    BOX: 0.05   # Box regression loss weight
    OBJ: 1.0    # Objectness loss weight
    CLS: 0.5    # Classification loss weight

  # Inference parameters
  CONF_THRESHOLD: 0.25  # Confidence threshold for detections
  NMS_THRESHOLD: 0.45   # NMS IoU threshold
  MAX_DETECTIONS: 300   # Maximum number of detections per image

DATA:
  DATA_PATH: dataset/supervised/synthetic_yolo
  NUM_CLASSES: 4  # Including background: 0=background, 1=class1, 2=class2, etc.

  # SAR-specific normalization
  SAR_NORM_SCALE: null  # Set to 16 for Capella data, null for others
  GLOBAL_STD: 1.5  # Use scripts/compute_global_std.py to compute from training data

  # Data augmentation
  AUGMENTATION:
    ENABLED: true
    COLOR_JITTER: true
    RANDOM_GAMMA: true

TRAIN:
  GPUS: 1
  NUM_WORKERS: 4
  EPOCHS: 50
  BATCH_SIZE: 8
  LR: 0.0001
  WEIGHT_DECAY: 0.0001
  LOG_FREQ: 10

  # Learning rate schedulers
  SCHEDULER:
    ENABLED: true
    MIN_LR: 0.00001

# Logging and checkpointing
LOGGING:
  LOG_DIR: logs/detection_experiments
  TENSORBOARD: true
  SAVE_TOP_K: 3  # Save top 3 checkpoints based on validation mAP

# Experiment tracking
EXPERIMENT:
  NAME: yolo_detection
  VERSION: null  # Auto-increment if null
  TAGS: []  # List of tags for experiment tracking
