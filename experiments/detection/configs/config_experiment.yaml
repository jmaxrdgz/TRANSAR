# config_experiment.yaml
# Configuration for Faster R-CNN detection experiments with multiple backbones

SEED: 42

MODEL:
  NAME: FasterRCNN
  IN_SIZE: 256
  IN_CHANS: 1  # SAR images are single-channel

  BACKBONE:
    NAME: swinv2_tiny_window8_256  # Options: swinv2_tiny_window8_256, resnet50, convnext_tiny, etc.
    PRETRAINED: true  # Use ImageNet pretrained weights
    WEIGHTS: null  # Path to custom pretrained weights (overrides PRETRAINED if set)

  # Progressive unfreezing
  NUM_BLOCKS_TO_UNFREEZE: 0  # 0 = freeze entire backbone, 1-4 = unfreeze last N blocks

  # RPN (Region Proposal Network) parameters
  RPN:
    ANCHOR_SIZES: [32, 64, 128, 256, 512]  # Anchor sizes for different scales
    ASPECT_RATIOS: [0.5, 1.0, 2.0]  # Anchor aspect ratios
    PRE_NMS_TOP_N_TRAIN: 2000  # Top N proposals before NMS (training)
    PRE_NMS_TOP_N_TEST: 1000  # Top N proposals before NMS (test)
    POST_NMS_TOP_N_TRAIN: 2000  # Top N proposals after NMS (training)
    POST_NMS_TOP_N_TEST: 1000  # Top N proposals after NMS (test)
    NMS_THRESH: 0.7  # NMS IoU threshold for RPN
    FG_IOU_THRESH: 0.7  # IoU threshold for positive anchors
    BG_IOU_THRESH: 0.3  # IoU threshold for negative anchors

  # Box prediction parameters
  BOX_SCORE_THRESH: 0.05  # Minimum score for detections
  BOX_NMS_THRESH: 0.5  # NMS IoU threshold for final detections
  BOX_DETECTIONS_PER_IMG: 100  # Maximum number of detections per image

DATA:
  DATA_PATH: dataset/supervised/synthetic_yolo
  NUM_CLASSES: 3  # Including background: 0=background, 1=class1, 2=class2, etc.

  # SAR-specific normalization
  SAR_NORM_SCALE: null  # Set to 16 for Capella data, null for others
  GLOBAL_STD: 1.5  # Use scripts/compute_global_std.py to compute from training data

  # Data augmentation
  AUGMENTATION:
    ENABLED: true
    COLOR_JITTER: true
    RANDOM_GAMMA: true

TRAIN:
  GPUS: 2
  NUM_WORKERS: 4
  EPOCHS: 50
  BATCH_SIZE: 4  # Smaller batch size for Faster R-CNN (memory intensive)
  LR: 0.0001
  WEIGHT_DECAY: 0.0001
  LOG_FREQ: 10

  # Learning rate scheduler
  SCHEDULER:
    ENABLED: true
    MIN_LR: 0.00001

# Logging and checkpointing
LOGGING:
  LOG_DIR: logs/detection_experiments
  TENSORBOARD: true
  SAVE_TOP_K: 3  # Save top 3 checkpoints based on validation mAP

# Experiment tracking
EXPERIMENT:
  NAME: faster_rcnn_detection
  VERSION: null  # Auto-increment if null
  TAGS: []  # List of tags for experiment tracking
